@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<div id="app">

    <div class="x_panel">
        <div class="x_title">
            <h2>Patient Dashboard <small></small></h2>
            <ul class="nav navbar-right panel_toolbox">
                <li>
                    <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                    <ul class="dropdown-menu" role="menu">
                        <li>
                            <a href="#">Settings 1</a>
                        </li>
                        <li>
                            <a href="#">Settings 2</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="close-link"><i class="fa fa-close"></i></a>
                </li>
            </ul>
            <div class="clearfix"></div>
        </div>
        <div class="x_content">
            <p class="text-muted font-13 m-b-30">
            </p>
            <div id="datatable_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
                <div class="row">
                    <div class="col-sm-12">
                        <table id="datatable" class="table table-striped table-bordered dataTable no-footer" role="grid" aria-describedby="datatable_info">
                            <thead>
                                <tr role="row">
                                    <th style="display:none" class="sorting_asc" aria-controls="datatable" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Name: activate to sort column descending">
                                        #
                                    </th>
                                    <th class="sorting_asc" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Name: activate to sort column descending">
                                        Claim
                                    </th>
                                    <th class="sorting" style="width:350px" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Position: activate to sort column ascending">
                                        Patient
                                    </th>
                                    <th class="sorting" tabindex="0" width="350px" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Office: activate to sort column ascending">
                                        Provider
                                    </th>
                                    <th tabindex="0" width="300px" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Age: activate to sort column ascending">
                                        Carrier
                                    </th>
                                    <th tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Age: activate to sort column ascending">
                                        Date
                                    </th>
                                    <th tabindex="0" style="width:150px;" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Age: activate to sort column ascending">
                                        Status
                                    </th>
                                    <th tabindex="0" class="ctd" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Age: activate to sort column ascending">
                                        Billed
                                    </th>
                                    <th tabindex="0" class="ctd" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Age: activate to sort column ascending">
                                        Ins
                                    </th>
                                    <th tabindex="0" class="ctd" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Age: activate to sort column ascending">
                                        Adj
                                    </th>
                                    <th tabindex="0" style="width:75px" class="ctd" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Age: activate to sort column ascending">
                                        Pat Pay
                                    </th>
                                    <th tabindex="0" class="ctd" aria-controls="datatable" rowspan="1" colspan="1" aria-label="Age: activate to sort column ascending">
                                        Balance
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="item in rows" role="row" class="odd">
                                    <td style="display:none">
                                        {{item.rn}}
                                    </td>
                                    <td>
                                        {{item.claimnumber}}
                                    </td>
                                    <td>
                                        {{item.patientfullname}}
                                    </td>
                                    <td>
                                        {{item.providerfullname}}
                                    </td>
                                    <td>
                                        {{item.carriername}}
                                    </td>
                                    <td>
                                        {{item.dateFormat}}
                                    </td>
                                    <td style="width:150px;">
                                        {{item.claimStatus}}
                                    </td>
                                    <td class="ctd">
                                        {{item.billed}}
                                    </td>
                                    <td class="ctd">
                                        {{item.insurance}}
                                    </td>
                                    <td class="ctd">
                                        {{item.adjustments}}
                                    </td>
                                    <td class="ctd">
                                        {{item.patientPay}}
                                    </td>
                                    <td class="ctd">
                                        {{item.balance}}
                                    </td>
                                 
                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="~/js/jquery.min.js"></script>

<script type="text/javascript">
    var $ = window.jQuery;
    var app = new Vue({
        el: '#app',
        data: {
            rows: [],
            pi: 0,
            pages: [],
            patientDetail: {}

        },
        mounted() {
            this.loadData();
        },
        methods: {
            loadData(pageIndex = 1) {
                let that = this;
                var pid = window.location.href.substr(window.location.href.lastIndexOf("/") + 1);
                
                var vic = 0;
                this.pi = pageIndex;
                that.rows = new Array();
                $.ajax({
                    type: "POST",
                    url: "../Dashboard",
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify({ "SearchCriteria": "", "PageIndex": 0, "PageSize": 100000, "PatientId": pid}),
                    success: function (data) {
                        $(data).each(function (index, d) {
                            if (index == 0) {
                                vic = d.virtualItemCount;
                            }
                            if (d) {
                                that.rows.push(d);
                            }
                        });
                        that.pages = new Array();
                        for (var i = 0; i <= vic / ps; i++) {
                            that.pages.push(i+1);
                        }
                    },
                    failure: function (errMsg) {
                        alert(errMsg);
                    }
                });
                $.ajax({
                    type: "GET",
                    url: "../PatientDetail/" + pid,
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        alert(JSON.stringify(data));
                    },
                    failure: function (errMsg) {
                        alert(errMsg);
                    }
                });
            }
        }
    })
</script>
<style>
    body {
        font-size: 8pt;
    }

    .ctd {
        text-align: right;
    }
</style>